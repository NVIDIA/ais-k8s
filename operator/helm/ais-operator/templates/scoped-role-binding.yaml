{{/*
This template is hard-coded and not auto-generated by kubebuilder/kustomize/helmify
It references the generated ClusterRole in manager-rbac.yaml by name
*/}}

{{- if .Values.namespaceScope }}

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: {{ include "ais-operator.fullname" . }}-manager-cluster-scope
  labels:
  {{- include "ais-operator.labels" . | nindent 4 }}
rules:
- apiGroups: [""]
  resources: ["nodes"]
  verbs: ["get", "list", "watch"]
- apiGroups: ["storage.k8s.io"]
  resources: ["storageclasses"]
  verbs: ["get", "list", "watch"]

---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: {{ include "ais-operator.fullname" . }}-manager-cluster-scope
  labels:
  {{- include "ais-operator.labels" . | nindent 4 }}
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: '{{ include "ais-operator.fullname" . }}-manager-cluster-scope'
subjects:
  - kind: ServiceAccount
    name: '{{ include "ais-operator.serviceAccountName" . }}'
    namespace: '{{ .Release.Namespace }}'

{{- range .Values.namespaceScope }}
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: {{ include "ais-operator.fullname" $ }}-manager-scoped
  namespace: {{ . }}
  labels:
  {{- include "ais-operator.labels" $ | nindent 4 }}
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: '{{ include "ais-operator.fullname" $ }}-manager-role'
subjects:
  - kind: ServiceAccount
    name: '{{ include "ais-operator.serviceAccountName" $ }}'
    namespace: '{{ $.Release.Namespace }}'
{{- end }}
{{- end }}